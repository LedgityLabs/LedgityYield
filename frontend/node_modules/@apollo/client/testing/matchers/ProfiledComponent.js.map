{"version":3,"file":"ProfiledComponent.js","sourceRoot":"","sources":["../../../src/testing/matchers/ProfiledComponent.ts"],"names":[],"mappings":";AACA,OAAO,EAAE,yBAAyB,EAAE,MAAM,sBAAsB,CAAC;AAQjE,MAAM,CAAC,IAAM,UAAU,GACrB,UAAgB,MAAM,EAAE,OAAO;;;;;;oBACvB,SAAS,GAAG,MAGQ,CAAC;oBACrB,QAAQ,GAAG,UAAU,IAAI,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC;oBACpE,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,YAAY,EAAE,mBAAmB,EAAE,EAAE,CAAC,CAAC;oBACvE,IAAI,GAAG,IAAI,CAAC;;;;oBAEd,qBAAM,QAAQ,CAAC,UAAU,YAAG,OAAO,EAAE,GAAG,IAAK,OAAO,EAAG,EAAA;;oBAAvD,SAAuD,CAAC;;;;oBAExD,IAAI,GAAC,YAAY,yBAAyB,EAAE,CAAC;wBAC3C,IAAI,GAAG,KAAK,CAAC;oBACf,CAAC;yBAAM,CAAC;wBACN,MAAM,GAAC,CAAC;oBACV,CAAC;;wBAGH,sBAAO;wBACL,IAAI,MAAA;wBACJ,OAAO;4BACL,OAAO,CACL,IAAI;gCACJ,mCAA4B,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,gBAAa;gCAC3D,oBAAa,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,MAAG,CACnC,CAAC;wBACJ,CAAC;qBACF,EAAC;;;;CACH,CAAC;AAEJ,yDAAyD;AACzD,IAAM,MAAM,GAAG,EAAE,CAAC;AAElB,MAAM,CAAC,IAAM,oBAAoB,GAE7B,UAAgB,MAAM,EAAE,KAAK,EAAE,gBAAgB;;;;;;oBAC3C,SAAS,GAAG,MAGQ,CAAC;oBACrB,QAAQ,GAAG,UAAU,IAAI,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC;oBACpE,OAAO,cAAK,OAAO,EAAE,GAAG,IAAK,gBAAgB,CAAE,CAAC;oBAChD,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;oBACxD,IAAI,GAAG,IAAI,CAAC;;;;oBAEd,IAAI,QAAQ,CAAC,gBAAgB,EAAE,GAAG,KAAK,EAAE,CAAC;wBACxC,MAAM,MAAM,CAAC;oBACf,CAAC;;;;;;yBAEQ,CAAA,QAAQ,CAAC,gBAAgB,EAAE,GAAG,KAAK,CAAA;oBACxC,qBAAM,QAAQ,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAA;;oBAAzC,SAAyC,CAAC;;;;;oBAG5C,gEAAgE;oBAChE,MAAM,GAAC,YAAY,yBAAyB,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAC,CAAC;;;oBAG1D,qBAAM,QAAQ,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAA;;oBAAzC,SAAyC,CAAC;;;;oBAE1C,yEAAyE;oBACzE,IAAI,CAAC,CAAC,GAAC,YAAY,yBAAyB,CAAC,EAAE,CAAC;wBAC9C,MAAM,GAAC,CAAC;oBACV,CAAC;;;;;oBAGH,IAAI,GAAC,KAAK,MAAM,EAAE,CAAC;wBACjB,IAAI,GAAG,KAAK,CAAC;oBACf,CAAC;yBAAM,CAAC;wBACN,MAAM,GAAC,CAAC;oBACV,CAAC;;yBAEH,sBAAO;wBACL,IAAI,MAAA;wBACJ,OAAO;4BACL,OAAO,CACL,IAAI;gCACJ,gCAAyB,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,6BAAmB,KAAK,MAAG;gCACtE,uBAAgB,QAAQ,CAAC,gBAAgB,EAAE,YAAS,CACrD,CAAC;wBACJ,CAAC;qBACF,EAAC;;;;CACH,CAAC","sourcesContent":["import type { MatcherFunction } from \"expect\";\nimport { WaitForRenderTimeoutError } from \"../internal/index.js\";\nimport type {\n  NextRenderOptions,\n  Profiler,\n  ProfiledComponent,\n  ProfiledHook,\n} from \"../internal/index.js\";\n\nexport const toRerender: MatcherFunction<[options?: NextRenderOptions]> =\n  async function (actual, options) {\n    const _profiler = actual as\n      | Profiler<any>\n      | ProfiledComponent<any, any>\n      | ProfiledHook<any, any>;\n    const profiler = \"Profiler\" in _profiler ? _profiler.Profiler : _profiler;\n    const hint = this.utils.matcherHint(\"toRerender\", \"ProfiledComponent\", \"\");\n    let pass = true;\n    try {\n      await profiler.peekRender({ timeout: 100, ...options });\n    } catch (e) {\n      if (e instanceof WaitForRenderTimeoutError) {\n        pass = false;\n      } else {\n        throw e;\n      }\n    }\n\n    return {\n      pass,\n      message() {\n        return (\n          hint +\n          `\\n\\nExpected component to${pass ? \" not\" : \"\"} rerender, ` +\n          `but it did${pass ? \"\" : \" not\"}.`\n        );\n      },\n    };\n  };\n\n/** to be thrown to \"break\" test execution and fail it */\nconst failed = {};\n\nexport const toRenderExactlyTimes: MatcherFunction<\n  [times: number, options?: NextRenderOptions]\n> = async function (actual, times, optionsPerRender) {\n  const _profiler = actual as\n    | Profiler<any>\n    | ProfiledComponent<any, any>\n    | ProfiledHook<any, any>;\n  const profiler = \"Profiler\" in _profiler ? _profiler.Profiler : _profiler;\n  const options = { timeout: 100, ...optionsPerRender };\n  const hint = this.utils.matcherHint(\"toRenderExactlyTimes\");\n  let pass = true;\n  try {\n    if (profiler.totalRenderCount() > times) {\n      throw failed;\n    }\n    try {\n      while (profiler.totalRenderCount() < times) {\n        await profiler.waitForNextRender(options);\n      }\n    } catch (e) {\n      // timeouts here should just fail the test, rethrow other errors\n      throw e instanceof WaitForRenderTimeoutError ? failed : e;\n    }\n    try {\n      await profiler.waitForNextRender(options);\n    } catch (e) {\n      // we are expecting a timeout here, so swallow that error, rethrow others\n      if (!(e instanceof WaitForRenderTimeoutError)) {\n        throw e;\n      }\n    }\n  } catch (e) {\n    if (e === failed) {\n      pass = false;\n    } else {\n      throw e;\n    }\n  }\n  return {\n    pass,\n    message() {\n      return (\n        hint +\n        ` Expected component to${pass ? \" not\" : \"\"} render exactly ${times}.` +\n        ` It rendered ${profiler.totalRenderCount()} times.`\n      );\n    },\n  };\n};\n"]}